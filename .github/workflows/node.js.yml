name: Node.js CI

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:
    runs-on: windows-latest

    strategy:
      matrix:
        node-version: [16.x]
        # See supported Node.js release schedule at https://nodejs.org/en/about/releases/

    steps:
      - uses: actions/checkout@v3

      - name: Use Node.js ${{ matrix.node-version }}
        uses: actions/setup-node@v3
        with:
          node-version: ${{ matrix.node-version }}
          cache: 'npm'

      - run: npm install -f

      - run: npm test -- --watch=false --browsers=ChromeHeadless

      - name: Archive test reports
        uses: actions/upload-artifact@v3
        if: success() || failure()
        with:
          name: karma_testReports
          path: test-results/

  deploy:
    runs-on: windows-latest
    needs: build  # This indicates that the deployment job depends on the 'build' job

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Deploy GitHub Pages
        uses: JamesIves/github-pages-deploy-action@4.1.0
        if: always()  # This ensures the deployment runs even if the 'build' job fails
        with:
          branch: gh-pages  # Customize this to the branch you want to deploy to (e.g., gh-pages)
          folder: test-results  # Adjust this to the folder containing your site's assets to be deployed

      - name: Display GitHub Pages Link
        if: always()  # This ensures the link is displayed even if the 'build' job fails
        run: |
          echo "GitHub Pages link:"
          echo "https://sayyed-muzammil04.github.io/Demo/"
